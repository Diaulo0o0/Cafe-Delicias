{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caf√© Delicias</title>
    
    <link rel="stylesheet" href="{% static 'estilo.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
</head>

<body class="d-flex flex-column min-vh-100">

<header>
    <nav class="navbar navbar-expand-lg bg-dark border-bottom border-body" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'index'%}">Caf√© Delicias</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" 
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                    
                    <li class="nav-item me-3">
                        <a class="btn btn-outline-light position-relative border-0" href="{% url 'carrito' %}">
                            <i class="fas fa-shopping-cart fa-lg"></i> 
                            <span class="d-lg-none ms-2">Ver Carrito</span> {% if request.session.carrito %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    {{ request.session.carrito|length }}
                                    <span class="visually-hidden">productos</span>
                                </span>
                            {% endif %}
                        </a>
                    </li>

                    {% if user.is_authenticated %}
                        <li class="nav-item d-flex align-items-center">
                            <span class="navbar-text me-3 d-none d-lg-block">
                                Hola, <strong>{{ user.username }}</strong>
                            </span>
                            <a class="btn btn-sm btn-outline-danger" href="{% url 'logout' %}">
                                <i class="fas fa-sign-out-alt"></i> Salir
                            </a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="btn btn-sm btn-primary" href="{% url 'login'%}">
                                <i class="fas fa-user"></i> Iniciar Sesi√≥n
                            </a>
                        </li>
                    {% endif %}
                </ul>

            </div>
        </div>
    </nav>
</header>

{% if messages %}
<div class="messages container mt-3">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>
<script>
    setTimeout(() => {
        const messages = document.querySelectorAll('.alert');
        messages.forEach(msg => {
            msg.style.transition = "opacity 0.5s ease";  
            msg.style.opacity = "0";  
            setTimeout(() => msg.remove(), 500); 
        });
    }, 5000); 
</script>
{% endif %}

<main class="container mt-4 text-center">
    {% if user.is_authenticated %}
        <h1>Bienvenido, {{ user.username }} ‚òï</h1>
        <p class="lead">Nos alegra tenerte de vuelta.</p>
    {% else %}
        <h1>Bienvenido a Caf√© Delicias</h1>
        <p class="lead">Descubre el sabor del verdadero caf√© artesanal.</p>
    {% endif %}
</main>

<div id="carouselExampleInterval" class="carousel slide mt-4" data-bs-ride="carousel">
    <div class="carousel-inner">
        <div class="carousel-item active" data-bs-interval="5000">
            <img src="{% static 'cafe1.png' %}" class="d-block w-100" alt="Caf√© en grano" style="max-height: 500px; object-fit: cover;">
        </div>
        <div class="carousel-item" data-bs-interval="5000">
            <img src="{% static 'cafe2.png' %}" class="d-block w-100" alt="Taza de caf√©" style="max-height: 500px; object-fit: cover;">
        </div>
        <div class="carousel-item">
            <img src="{% static 'cafe3.png' %}" class="d-block w-100" alt="Caf√© con leche" style="max-height: 500px; object-fit: cover;">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
    </button>
</div>

<h1 class="text-center mt-5" id="menu">Nuestro Men√∫</h1>
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <form method="GET" action="{% url 'index' %}">
                <div class="card p-4 shadow-sm border-0 filter-bar" style="background-color: #fdfbf7;">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold text-muted small">Buscar</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                                <input type="text" name="q" class="form-control border-start-0" placeholder="Ej: Capuccino..." value="{{ request.GET.q|default:'' }}">
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label fw-bold text-muted small">Categor√≠a</label>
                            <select name="categoria" class="form-select">
                                <option value="" {% if not request.GET.categoria %}selected{% endif %}>Todas</option>
                                <option value="caliente" {% if request.GET.categoria == 'caliente' %}selected{% endif %}>Caf√©s Calientes</option>
                                <option value="frio" {% if request.GET.categoria == 'frio' %}selected{% endif %}>Caf√©s Helados</option>
                                <option value="grano" {% if request.GET.categoria == 'grano' %}selected{% endif %}>Caf√© en Grano</option>
                                <option value="acompanamiento" {% if request.GET.categoria == 'acompanamiento' %}selected{% endif %}>Dulces</option>
                            </select>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label fw-bold text-muted small">Ordenar</label>
                            <select name="orden" class="form-select">
                                <option value="" {% if not request.GET.orden %}selected{% endif %}>Relevancia</option>
                                <option value="precio_asc" {% if request.GET.orden == 'precio_asc' %}selected{% endif %}>Precio: Menor a Mayor</option>
                                <option value="precio_desc" {% if request.GET.orden == 'precio_desc' %}selected{% endif %}>Precio: Mayor a Menor</option>
                            </select>
                        </div>

                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

{% if recomendaciones %}
<div class="container mt-5">
    <h4 class="mb-3 text-muted">Recomendado para ti</h4>
    <div class="row g-3">
        {% for producto in recomendaciones %}
        <div class="col-6 col-md-3">
            <div class="card border-0 h-100 shadow-sm">
                {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" class="card-img-top" alt="{{ producto.nombre }}" style="height: 140px; object-fit: cover;">
                {% else %}
                    <img src="{% static 'cafe_defecto.png' %}" class="card-img-top" alt="Sin imagen" style="height: 140px; object-fit: cover;">
                {% endif %}
                
                <div class="card-body p-2 text-center">
                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">{{ producto.nombre }}</h6>
                    <p class="card-text text-muted mb-2" style="font-size: 0.8rem;">Recomendado ‚≠ê</p>
                    
                    <a href="#producto-{{ producto.id }}" class="btn btn-outline-primary btn-sm w-100" style="font-size: 0.8rem;">
                        Ver
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="container mt-5 mb-5">
    {% if esta_filtrando %}
        <h2 class="mb-4">Resultados de tu b√∫squeda</h2>
        {% if productos %}
            <div class="row g-4">
                {% for producto in productos %}
                    {% include 'cafe_cafe/producto_card.html' %}
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <h3 class="text-muted">No encontramos coincidencias üò¢</h3>
                <a href="{% url 'index' %}" class="btn btn-outline-primary mt-3">Ver todo el men√∫</a>
            </div>
        {% endif %}
    {% else %}
        {% if cafes_calientes %}
        <h2 class="text-start mt-5 mb-4" id="menu-caliente">Caf√©s Calientes</h2>
        <div class="row g-4">
            {% for producto in cafes_calientes %}
                {% include 'cafe_cafe/producto_card.html' %}
            {% endfor %}
        </div>
        {% endif %}

        {% if cafes_frios %}
        <h2 class="text-start mt-5 mb-4" id="menu-helado">Caf√©s Helados</h2>
        <div class="row g-4">
            {% for producto in cafes_frios %}
                {% include 'cafe_cafe/producto_card.html' %}
            {% endfor %}
        </div>
        {% endif %}
    {% endif %}
</div>

<footer class="footer mt-auto py-4">
    <div class="container">
        <div class="footer-row">
            <div class="footer-links">
                <h4>Compa√±√≠a</h4>
                <ul>
                    <li><a href="{% url 'nosotros'%}">Nosotros</a></li>
                    <li><a href="{% url 'nuestrosservicios'%}">Nuestros Servicios</a></li>
                    <li><a href="{% url 'politicaspriv'%}">Pol√≠tica de Privacidad</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Ayuda</h4>
                <ul>
                    <li><a href="{% url 'preguntas'%}">Preguntas Frecuentes</a></li>
                    <li><a href="{% url 'envios'%}">Env√≠os</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Tienda</h4>
                <ul>
                    <li><a href="https://www.google.com/maps/place/Caff%C3%A8+La+Cleta/@-33.5352953,-70.5570756,15.5z/data=!4m10!1m2!2m1!1stiendas+de+cafe+chile!3m6!1s0x9662d11549b71961:0xaa228146a1c4577d!8m2!3d-33.5357279!4d-70.5509519!15sChV0aWVuZGFzIGRlIGNhZmUgY2hpbGVaFyIVdGllbmRhcyBkZSBjYWZlIGNoaWxlkgEEY2FmZZoBI0NoWkRTVWhOTUc5blMwVkpRMEZuU1VOMU5tRnhTbVZSRUFFqgFeCgkvbS8wMnZxZm0QASoTIg90aWVuZGFzIGRlIGNhZmUoDjIfEAEiG9ix1SrUGTudlZiZ3ajERsv9gvuwtFbs1zmtkjIZEAIiFXRpZW5kYXMgZGUgY2FmZSBjaGlsZeABAPoBBAgAEEQ!16s%2Fg%2F11gdrsc8w6?entry=ttu&g_ep=EgoyMDI1MDgyNS4wIKXMDSoASAFQAw%3D%3D" target="_blank">Ubicaci√≥n</a></li>
                    <li><a href="https://www.marleycoffee.cl/" target="_blank">Empresa Proveedora</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>S√≠guenos</h4>
                <div class="social-links">
                    <a href="https://www.facebook.com/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="https://x.com/" target="_blank"><i class="fab fa-x"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
</body>
</html>